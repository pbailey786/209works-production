# Task ID: 46
# Title: Multi-Region .works Domain Strategy Implementation
# Status: pending
# Dependencies: None
# Priority: high
# Description: Complete the rollout of the regional job board strategy with multiple .works domains (209.works, 916.works, 510.works, norcal.works) served from a shared backend. Focus on scaling to 5 regional brands with minimal code duplication, strong SEO for each domain, improved technical infrastructure, and preparation for regional marketing and user onboarding.
# Details:
This task encompasses the complete implementation of the multi-region domain strategy including: 1) SEO optimization with dynamic metadata and sitemaps, 2) Regional job filtering and database schema updates, 3) Analytics implementation with regional tracking, 4) Regional content strategy and local SEO, 5) Performance optimization across domains, 6) Marketing preparation and user onboarding systems. The goal is to create a scalable architecture that supports 5+ regional domains with strong local positioning and minimal code duplication.

# Test Strategy:
Test dynamic metadata generation across all domains, verify regional job filtering accuracy, validate analytics tracking for regional events, test sitemap generation for each domain, verify robots.txt functionality, test OG image loading, validate regional content display, test cross-domain functionality, verify performance across all regional domains, and conduct user acceptance testing for regional features.

# Subtasks:
## 1. Create Regional Open Graph Images [done]
### Dependencies: None
### Description: Design and create Open Graph images (1200x630px) for each regional domain to improve social media sharing and SEO.
### Details:
Create branded OG images for each domain: 209-og.jpg (Central Valley theme), 916-og.jpg (Sacramento theme), 510-og.jpg (East Bay theme), and norcal-og.jpg (Northern California theme). Images should include regional branding, area code, and job board messaging. Place in public/og-images/ directory.
<info added on 2025-05-28T16:01:49.328Z>
Successfully created branded Open Graph images (1200x630px) for all four regional domains:

- **209-og.svg** - Central Valley theme with Valley Blue (#2563EB) and Harvest Gold (#F59E0B)
- **916-og.svg** - Sacramento Metro theme with Capitol Blue (#1E40AF) and Government Gold (#D97706)
- **510-og.svg** - East Bay theme with Bay Blue (#0EA5E9) and Innovation Orange (#EA580C)
- **norcal-og.svg** - Northern California hub theme with NorCal Blue (#1D4ED8) and Regional Gold (#CA8A04)

**Design Features:**

- Professional gradient backgrounds using established brand colors
- Regional area codes prominently displayed in circular logos
- Branded taglines from the branding guide ("Where Central Valley Works", "Capital Region Careers", etc.)
- Major cities listed for each region
- Call-to-action buttons with regional messaging
- Decorative elements reflecting regional character (Capitol dome for 916, Bay bridge for 510, etc.)
- Consistent layout and typography across all domains
- Shadow effects and professional styling for social media impact

**File Location:** All images saved in `/public/og-images/` directory as SVG files for scalability and crisp rendering across all social media platforms.

**Ready for Integration:** These OG images are now ready to be referenced in the regional SEO metadata and will significantly improve social media sharing appearance for each domain.
</info added on 2025-05-28T16:01:49.328Z>

## 2. Implement Regional Job Filtering Database Schema [done]
### Dependencies: None
### Description: Add region field to job schema and implement database-level regional job filtering for improved performance and accuracy.
### Details:
Create Prisma migration to add 'region' VARCHAR(10) field to jobs table, create index on region field, write data migration script to populate existing jobs with region based on location matching, update job creation APIs to automatically assign region, and modify job search queries to filter by region efficiently.
<info added on 2025-05-28T16:29:47.923Z>
**Database Schema Updates:**

- **Prisma Schema Modification:**
  - Added `region` field to the `Job` model in the Prisma schema:
    ```prisma
    model Job {
      id        Int      @id @default(autoincrement())
      title     String
      location  String
      region    String?  @db.VarChar(10)
      // other fields...
    }
    ```
  - Created a database migration named `20250528162657_add_region_to_jobs` to add the `region` column to the `jobs` table.

- **Index Creation:**
  - Implemented efficient indexes to enhance regional filtering performance:
    ```prisma
    @@index([region]) // Basic regional filtering
    @@index([region, jobType]) // Region + job type queries
    @@index([region, postedAt]) // Region + date queries
    ```
    These indexes are defined in the Prisma schema to optimize query performance. ([prisma.io](https://www.prisma.io/docs/orm/prisma-schema/data-model/models?utm_source=openai))

- **Migration Application:**
  - Successfully applied the migration to the database, ensuring the `region` field and associated indexes are in place.

**Regional Job Service Implementation:**

- **Service Development:**
  - Developed a comprehensive `RegionalJobService` class with the following functionalities:
    - `getRegionalJobs()`: Advanced filtering by region, job type, location, keywords, salary, date, and categories.
    - `getRegionalStats()`: Provides regional statistics, including job counts, new jobs, top categories, average salary, and top companies.
    - `assignRegionToJob()`: Implements logic to assign regions to jobs based on location for all four regions.
    - `assignRegionsToExistingJobs()`: Bulk updates existing jobs with regional assignments.
    - `getRegionSummary()`: Offers an overview of all regions with job counts.
    - `searchAcrossRegions()`: Enables cross-regional job search functionality.

**Regional Assignment Logic:**

- **Region Definitions:**
  - **Central Valley (209):** Includes cities such as Stockton, Modesto, Tracy, Manteca, Lodi, Turlock, Merced, Fresno, Visalia, Bakersfield, etc.
  - **Sacramento Metro (916):** Covers Sacramento, Elk Grove, Roseville, Folsom, Davis, Woodland, West Sacramento, etc.
  - **East Bay (510):** Encompasses Oakland, Berkeley, Fremont, Hayward, Richmond, Alameda, San Leandro, etc.
  - **Northern California (norcal):** Represents the broader Northern California area, including the Bay Area, San Francisco, and Silicon Valley as a fallback.

**API Endpoints Created:**

- **Endpoints:**
  - `GET /api/jobs/regional`: Facilitates regional job filtering with comprehensive query parameters.
  - `GET /api/jobs/regional/stats`: Provides regional statistics and summaries.
  - `POST /api/jobs/regional/assign`: Allows admin-only bulk regional assignment.

**Testing Infrastructure:**

- **Test Script:**
  - Developed a comprehensive test script named `test-regional-assignment.ts` to:
    - Validate location-to-region assignment logic.
    - Test regional search and statistics functionality.
    - Ensure cross-regional search capabilities.

**Technical Features:**

- **Performance Enhancements:**
  - Implemented efficient database queries with proper indexing to optimize performance.
  - Incorporated comprehensive error handling and validation mechanisms.
  - Added pagination support for large result sets.
  - Provided flexible filtering options, including salary, date, categories, and keywords.
  - Developed smart regional assignment based on location parsing.
  - Enabled cross-regional search capabilities.
  - Secured admin-protected bulk operations.

The regional job filtering system is now fully implemented and ready for integration with the frontend components.
</info added on 2025-05-28T16:29:47.923Z>

## 3. Set Up PostHog Analytics with Regional Tracking [done]
### Dependencies: 46.1
### Description: Implement PostHog analytics system with regional context tracking for user behavior analysis and business intelligence.
### Details:
Install posthog-js package, create PostHog provider with regional context, implement event tracking for job searches/views/applications with regional metadata, set up user identification with regional preferences, create regional analytics dashboards, implement A/B testing framework for regional features, and ensure GDPR compliance for data collection.
<info added on 2025-05-28T16:34:19.971Z>
Implemented PostHog analytics with regional context to track job searches, views, and applications, ensuring GDPR compliance through EU data hosting and user consent management. ([posthog.com](https://posthog.com/docs/privacy/gdpr-compliance?utm_source=openai))
</info added on 2025-05-28T16:34:19.971Z>

## 4. Create Regional Landing Pages for Major Cities [done]
### Dependencies: 46.2
### Description: Develop city-specific landing pages within each regional domain to capture local search traffic and improve regional SEO.
### Details:
Create landing pages for major cities in each region (e.g., /stockton-jobs, /modesto-jobs for 209.works). Include local job listings, city-specific content, local business partnerships, regional salary data, and optimized meta tags for local SEO. Implement dynamic routing and content management for scalability.
<info added on 2025-05-28T16:44:37.328Z>
The PostHog analytics system has been successfully integrated into the landing pages, providing comprehensive regional tracking capabilities. This integration ensures that user interactions are monitored with regional context, enhancing the relevance and effectiveness of the landing pages. Additionally, the implementation adheres to GDPR compliance standards, incorporating features such as consent management and data minimization to protect user privacy.
</info added on 2025-05-28T16:44:37.328Z>

## 5. Implement Regional Content Management System [pending]
### Dependencies: 46.4
### Description: Create a content management system for regional blog posts, job market reports, and local business spotlights to support regional SEO and marketing.
### Details:
Build CMS for regional content including job market reports, local business spotlights, career guides, and regional news. Implement content scheduling, SEO optimization, regional tagging, and social media integration. Create templates for consistent regional branding and automated content distribution.

## 6. Optimize Regional Performance and Caching [pending]
### Dependencies: 46.2, 46.3
### Description: Implement regional-specific performance optimizations including CDN configuration, caching strategies, and database query optimization.
### Details:
Set up regional CDN optimization for faster loading, implement regional caching strategies for job listings and content, optimize database queries for regional filtering, implement regional edge functions for improved performance, and set up performance monitoring for each domain with automated alerts.

## 7. Set Up Regional Social Media and Marketing Infrastructure [pending]
### Dependencies: 46.1, 46.5
### Description: Create social media accounts and marketing infrastructure for each regional domain to support local marketing campaigns.
### Details:
Create Facebook, Instagram, and Twitter accounts for each region (209jobs, 916jobs, 510jobs, norcaljobs), set up regional Google My Business listings, create regional email marketing templates, implement social media automation for job posting, and develop regional hashtag strategies and content calendars.

## 8. Implement Regional User Onboarding and Preferences [pending]
### Dependencies: 46.2, 46.3
### Description: Create regional-specific user onboarding flows and preference management to improve user experience and retention.
### Details:
Develop regional onboarding flows with local job recommendations, implement regional preference settings for users, create regional job alert systems, implement cross-regional job discovery features, and develop regional user segmentation for targeted marketing and content delivery.

## 9. Create Regional Business Partnership Program [pending]
### Dependencies: 46.7
### Description: Develop partnerships with local chambers of commerce, business associations, and educational institutions to strengthen regional positioning.
### Details:
Identify and reach out to regional chambers of commerce, create partnership agreements with local business associations, establish relationships with community colleges and universities, develop co-marketing opportunities, create regional business directory integration, and implement local event sponsorship and participation strategies.

## 10. Implement Regional SEO Monitoring and Reporting [pending]
### Dependencies: 46.4, 46.6
### Description: Set up comprehensive SEO monitoring and reporting system to track regional domain performance and search rankings.
### Details:
Implement SEO tracking for each regional domain, set up Google Search Console for all domains, create automated SEO reports, monitor regional keyword rankings, track local search performance, implement competitor analysis for regional markets, and create SEO performance dashboards with automated alerts for ranking changes.

